<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-README">README</h1>

<h2 id="label-About+Municipal2">About Municipal2</h2>

<p>An application for recording city complaints via Twitter.</p>

<p>Based on the Rails App Starter Kit.</p>

<h2 id="label-Running+on+Heroku">Running on Heroku</h2>

<p>If you&#39;re hosting both the master branch and this branch on Heroku, it
is best to create a different application for this branch, as follows:</p>
<ol><li>
<p>Go to the Heroku dashboard and create a new app</p>
</li><li>
<p>Note down its Git URL</p>
</li><li>
<p>Go to your local repo and add the above URL as a new remote:</p>

<pre class="code ruby"><code class="ruby">$ git remote add heroku-municipal2 the-Git-URL</code></pre>
</li><li>
<p>Push this branch to the master branch of the newly created remote:</p>

<pre class="code ruby"><code class="ruby">$ git push heroku-municipal2 municipal2:master</code></pre>
</li></ol>

<h2 id="label-Background+Jobs">Background Jobs</h2>

<p>The TweetFetcher job (which listens for tweets from the Twitter Streaming
API and stores them in the database) must be started manually, if not
already running, from the rails console as follows:</p>

<pre class="code ruby"><code class="ruby">$ TweetFetcherJob.enqueue</code></pre>

<h2 id="label-About+Rails+App+Starter+Kit">About Rails App Starter Kit</h2>

<p>A starter kit for creating applications using the Postgres, Rails and
Angular stack, with the following features built-in:</p>
<ol><li>
<p>Rails ~4.2, Angular ~1.2 (and we recommend Ruby &gt;=2.1.2)</p>
</li><li>
<p>Postgres support</p>
</li><li>
<p>Complete user management, with authentication and role-based authorization</p>
</li><li>
<p>Front-end asset management using Bower</p>
</li><li>
<p>Angular-based routing</p>
</li><li>
<p>Angular interfacing with server CSRF protection and server form validation</p>
</li><li>
<p>Rails code testing using RSpec and other best practices</p>
</li><li>
<p>Angular and JS code testing using Teaspoon</p>
</li><li>
<p>Ready-to-deploy on Heroku</p>
</li></ol>

<p>Several ideas have been taken from <a
href="http://angular-rails.com">angular-rails.com</a>.</p>

<p>See Gemfile.lock for each gem&#39;s version. We recommend using these
versions, or newer, for best results.</p>

<h2 id="label-Setting+Up">Setting Up</h2>

<p>Pre-requisites: You must have Node, Bower and Ruby installed.</p>
<ol><li>
<p>Download or clone this repo</p>
</li><li>
<p>Run the following commands in the application&#39;s root directory:</p>

<pre class="code ruby"><code class="ruby">$ bundle install</code></pre>

<p>This should set up all the gems required. Note: Installing the pg gem can
be a pain. See <a
href="http://stackoverflow.com/questions/19262312/installing-pg-gem-failure-to-build-native-extension">stackoverflow.com/questions/19262312/installing-pg-gem-failure-to-build-native-extension</a>
for help.</p>

<pre class="code ruby"><code class="ruby">$ rake bower:install</code></pre>

<p>This should set up all the front-end assets required.</p>
</li><li>
<p>Create two databases named as follows, or edit /config/database.yml to suit
your needs, and then create the appropriate databases:</p>
<ul><li>
<p>&#39;rails-app-starter-kit_development&#39; (for developing)</p>
</li><li>
<p>&#39;rails-app-starter-kit_test&#39; (for testing)</p>
</li></ul>

<p>Also change the production database details, either now, or before you wish
to push your app to production. If you use Heroku, these details will be
overridden anyway, but its still a good idea to change them.</p>
</li><li>
<p>Run the following command:</p>

<pre class="code ruby"><code class="ruby">$ rake db:migrate</code></pre>

<p>This will set up the required tables in the database.</p>
</li><li>
<p>Change the session key in config/initializers/session_store.rb to suit your
application.</p>
</li></ol>

<h2 id="label-App+Structure">App Structure</h2>

<p>The application structure is similar to a standard Rails app, with certain
additions, a sampling of which is shown below:</p>

<pre class="code ruby"><code class="ruby">app
 |- assets
     |- javascripts
         |- angular (contains all Angular code)
             |- app.js (the &#39;entry point&#39; for Angular)
             |- routes.js.erb
             |- controllers
             |- directives
             |- templates (contains all Angular templates, i.e. views)
 |- controllers
     |- home_controller.rb (the &#39;entry point&#39; controller)
 |- jobs (contains all background jobs)
 |- policies (user authorization policies)
 |- views
     |- home
         |- index.html (the &#39;entry point&#39; view)
specs (contains all tests)
 |- support (utility stuff for testing)
 |- javascripts (contains all JS and Angular tests)
vendor
 |- assets
     |- bower_components (all front-end components mananged by Bower)</code></pre>

<h2 id="label-Dev+Tools">Dev Tools</h2>

<h3 id="label-Rails+Generators">Rails Generators</h3>

<p>Rails generators have been configured not to generate non-useful files such
as assets, helpers, views, or view specs. This is because we are using
Angular as our main MVC framework and not Rails.</p>

<h3 id="label-Model+Annotation">Model Annotation</h3>

<p>We use the &#39;annotate&#39; gem to add column information to models.
Without this, it is difficult to know at a glance the columns within a
model table. Run this gem generally after you run a migration, as follows:</p>

<pre class="code ruby"><code class="ruby">$ annotate --position before</code></pre>

<h3 id="label-Front-end+Asset+Management">Front-end Asset Management</h3>

<p>Normally, Rails does asset management from within the
(app/lib/vender)/assets folders. However, because we are supporting very
&#39;front-end heavy&#39; applications, we use Bower, which is the most
widely used such tool. We use the &#39;bower-rails&#39; gem for this
purpose. See the following for more information:</p>
<ul><li>
<p><a href="http://bower.io">bower.io</a></p>
</li><li>
<p><a
href="https://github.com/42dev/bower-rails">github.com/42dev/bower-rails</a></p>
</li></ul>

<p>To add/remove front-end libraries, add-to/remove-from the /bower.json file
the required library/libraries. Then run:</p>

<pre class="code ruby"><code class="ruby">$ rake bower:install</code></pre>

<p>Also remember to reference/de-reference the relevant files in
application.js, and/or application.css.</p>

<h3 id="label-Testing">Testing</h3>

<p>We use RSpec (instead of the default TestUnit) for Rails code testing. See
the following for more information:</p>
<ul><li>
<p><a
href="https://github.com/rspec/rspec-rails">github.com/rspec/rspec-rails</a></p>
</li><li>
<p><a href="http://rspec.info">rspec.info</a></p>
</li></ul>

<p>We use FactoryGirl for creating real or mock objects required for testing.
See the following for more information:</p>
<ul><li>
<p><a
href="https://github.com/thoughtbot/factory_girl/blob/master/GETTING_STARTED.md">github.com/thoughtbot/factory_girl/blob/master/GETTING_STARTED.md</a></p>
</li><li>
<p><a
href="https://github.com/thoughtbot/factory_girl_rails">github.com/thoughtbot/factory_girl_rails</a></p>
</li></ul>

<p>We use Teaspoon (which supports several test frameworks - Jasmine, Mocha
and QUnit) for JS and Angular code testing. See <a
href="https://github.com/modeset/teaspoon">github.com/modeset/teaspoon</a>
for more information.</p>

<p>For a detailed discussion on testing, see the Testing section later on.</p>

<h2 id="label-Out-of-the-box+Functionality">Out-of-the-box Functionality</h2>

<h3 id="label-Authentication">Authentication</h3>

<p>Authentication is done via the &#39;devise&#39; gem (see <a
href="https://github.com/plataformatec/devise">github.com/plataformatec/devise</a>).
Users are stored in the &#39;User&#39; model.</p>

<p>The entire devise workflow is, after weighing the pros and cons,
deliberately kept outside of Angular. See <a
href="https://medium.com/opinionated-angularjs/techniques-for-authentication-in-angularjs-applications-7bbf0346acec">medium.com/opinionated-angularjs/techniques-for-authentication-in-angularjs-applications-7bbf0346acec</a>
for a detailed discussion; note however that our implementation is
different. Relevant files in our implementation are:</p>
<ul><li>
<p>app/assets/javascripts/angular/directives/authentication_links.js</p>
</li><li>
<p>controllers/application_controller (the &#39;set_sign_in_redirect&#39;
method)</p>
</li><li>
<p>All devise related files, of course</p>
</li></ul>

<p>In the JS and Angular code, the currently signed in user details are
available through the &#39;AuthSvc&#39; service. We have also provided
helper methods to control access to certain routes based on whether a user
is signed in, and optionally has certain roles. See the following for more
details:</p>
<ul><li>
<p>app/assets/javascripts/angular/routes.js</p>
</li><li>
<p>app/assets/javascripts/angular/services/auth_svc.js</p>
</li></ul>

<h3 id="label-Authorization">Authorization</h3>

<p>Authorization in the Ruby code is done via two gems:</p>
<ul><li>
<p><a href="https://github.com/RolifyCommunity/rolify">rolify</a>: For
assigning roles to users</p>
</li><li>
<p><a href="https://github.com/elabs/pundit">pundit</a>: For authorizing
actions based on roles</p>
</li></ul>

<p>Authorization policies are placed in app/policies.</p>

<p>In JS and Angular code, role-based authorization has been implemented to
the extent of route access. See the Authentication section above.</p>

<h3 id="label-Form+Submission">Form Submission</h3>

<p>Form validation should generally take place at the Angular end. However,
this may not always be possible, and you may choose to leave some
validation exclusively on the server-side.</p>

<p>We provide a clean integration between Angular form validation and
server-side form validation via the &#39;formErrors&#39; directive. See
app/assets/javascripts/angular/directives/form_errors.js.</p>

<h3 id="label-Background+Jobs">Background Jobs</h3>

<p>We provide DelayedJob for running background jobs. For most apps, this is
sufficient. However, switching to Resque, Sidekiq etc. is very easy, since
the actual jobs can be written using the Rails 4.2 ActiveJob “facade”. For
more information see:</p>
<ul><li>
<p><a
href="http://edgeguides.rubyonrails.org/active_job_basics.html">edgeguides.rubyonrails.org/active_job_basics.html</a></p>
</li><li>
<p><a
href="https://github.com/collectiveidea/delayed_job">github.com/collectiveidea/delayed_job</a></p>
</li></ul>

<h2 id="label-Testing+in+Detail">Testing in Detail</h2>

<h3 id="label-Testing+Rails+Code">Testing Rails Code</h3>

<p>Testing is a vast subject, best learnt from hands-on experience. See the
following for ideas on how to get started:</p>
<ul><li>
<p><a
href="https://github.com/howaboutwe/rspec-style-guide">github.com/howaboutwe/rspec-style-guide</a></p>
</li><li>
<p><a
href="http://dhartweg.roon.io/rspec-testing-for-a-json-api">dhartweg.roon.io/rspec-testing-for-a-json-api</a></p>
</li></ul>

<h4 id="label-Mock+Objects">Mock Objects</h4>

<p>Most tests require the use of real or mock objects against which tests can
be run. We use FactoryGirl and rspec-mocks for creating such objects. Each
has its advantages, and when to choose which is beautifully explained here:
<a
href="http://www.agileventures.org/articles/testing-with-rspec-stubs-mocks-factories-what-to-choose">www.agileventures.org/articles/testing-with-rspec-stubs-mocks-factories-what-to-choose</a>.</p>

<h4 id="label-User+Authentication">User Authentication</h4>

<p>Many controller tests require a user (possibly having certain roles) to be
signed in. We have provided integration with devise for easy
authentication. See the following for more information:</p>
<ul><li>
<p>spec/factories/users.rb</p>
</li><li>
<p>spec/support/controller_macros.rb</p>
</li></ul>

<h4 id="label-Authorization+Policy+Testing">Authorization Policy Testing</h4>

<p>We provide an easy way to test authorization policies generated using
pundit. See spec/support/pundit_matcher.rb for relevant RSpec matchers.</p>

<p>Authorization policy tests are placed in spec/policies.</p>

<h3 id="label-Testing+JS+and+Angular+Code">Testing JS and Angular Code</h3>

<p>Coming soon.</p>

<h2 id="label-Contributing%2FUsing">Contributing/Using</h2>

<h3 id="label-Creating+a+CRUD+Resource">Creating a CRUD Resource</h3>
<ol><li>
<p>Run:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_g'>g</span> <span class='id identifier rubyid_resource'>resource</span> <span class='const'>Widget</span> <span class='lparen'>(</span><span class='id identifier rubyid_substitute'>substitute</span> <span class='const'>Widget</span> <span class='id identifier rubyid_with'>with</span> <span class='id identifier rubyid_resource'>resource</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span></code></pre>

<p>OR</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_g'>g</span> <span class='id identifier rubyid_model'>model</span> <span class='const'>Widget</span>
<span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_g'>g</span> <span class='id identifier rubyid_controller'>controller</span> <span class='const'>Widgets</span></code></pre>
</li><li>
<p>Edit the config/routes.rb file</p>
</li><li>
<p>Write some model unit tests. For reference see:</p>
<ul><li>
<p>spec/models/post_spec.rb</p>
</li><li>
<p>spec/factories/posts.rb</p>
</li></ul>
</li><li>
<p>Write some model functionality</p>
</li><li>
<p>Create an authorization policy. For reference see
app/policies/post_policy.rb.</p>
</li><li>
<p>Write some controller unit tests. For reference see
spec/controllers/posts_controller_spec.rb.</p>
</li><li>
<p>Write some authorization polict tests. For reference see
spec/policies/post_policy_spec.rb.</p>
</li><li>
<p>Write some controller functionality</p>
</li><li>
<p>Write the server views (which basically render out responses as JSON). For
reference, see app/views/posts/index.json.jbuilder. JBuilder (<a
href="https://github.com/rails/jbuilder">github.com/rails/jbuilder</a>)
comes bundles with Rails, and is a much better way to create JSON, than
using the &#39;as_json&#39; method.</p>
</li><li>
<p>Create an Angular resource to communicate with the controller. See
app/assets/javascripts/angular/services/post.js.</p>
</li><li>
<p>Create an Angular controller that uses the resource. For reference see
app/assets/javascripts/angular/controllers/posts_ctrl.js.</p>
</li><li>
<p>Write some Angular controller unit tests. For reference see
app/spec/javascripts/controllers/home_ctrl_spec.js.</p>
</li><li>
<p>Create an Angular view (template). For reference see
app/assets/javascripts/angular/templates/controllers/posts/index.html.</p>
</li><li>
<p>Update the app/assets/javascripts/angular/routes.js file</p>
</li><li>
<p>Create any directives that may be required for the view</p>
</li><li>
<p>Write some directive unit tests</p>
</li></ol>

<h3 id="label-Coding+Style+Conventions">Coding Style Conventions</h3>

<h4 id="label-General">General</h4>
<ol><li>
<p>Lines are kept within 80 characters</p>
</li><li>
<p>2 spaces are used as tabs, with 4 spaces for continuation</p>
</li></ol>

<h4 id="label-Comments">Comments</h4>
<ol><li>
<p>Comments are compatible with Yard. For more information, see:</p>
<ul><li>
<p><a href="http://yardoc.org/index.html">yardoc.org/index.html</a></p>
</li><li>
<p><a
href="http://tech.pro/tutorial/1363/documenting-your-ruby-code-with-yard">tech.pro/tutorial/1363/documenting-your-ruby-code-with-yard</a></p>
</li></ul>
</li><li>
<p>General Rules</p>
<ol><li>
<p>Single-line-single-sentence comments do not end with a full-stop</p>
</li><li>
<p>Multiple-line or multiple-sentence comments end with a full-stop</p>
</li><li>
<p>All comments are in sentence case</p>
</li><li>
<p>Multiple-line comments can be written using the /<strong>..</strong>/
style, in which case, the opening /* must be an empty line</p>
</li></ol>
</li></ol>

<h2 id="label-Appendix">Appendix</h2>

<p>Contains everything that didn&#39;t fit in anywhere else on this README.</p>

<h3 id="label-This+README">This README</h3>

<p>This README is compatible with RDoc.</p>

<h3 id="label-Useful+Links">Useful Links</h3>
<ol><li>
<p><a href="http://docs.seattlerb.org/rdoc/RDoc/Markup.html">RDoc Markup
reference</a></p>
</li><li>
<p><a
href="https://github.com/rack/rack/blob/1.5.2/lib/rack/utils.rb#L544">HTTP
codes and their Rails symbols</a></p>
</li></ol>
</div></div>

    <div id="footer">
  Generated on Wed Oct  8 12:56:38 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.2).
</div>

  </body>
</html>